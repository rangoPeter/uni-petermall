import Vue from 'vue'

const state = {
	goodsDetailInfo: [
		{
				"isChecked": 1,
				"count": 2,
		    "promId": 0,
		    "showPoints": false,
		    "itemTagList": [
		        {
		            "itemId": 3522104,
		            "tagId": 128111154,
		            "freshmanExclusive": false,
		            "name": "暖冬特惠",
		            "subType": 204,
		            "forbidJump": false,
		            "type": 2
		        }
		    ],
		    "rank": 1,
		    "id": 3522104,
		    "sellVolume": 2666,
		    "primaryPicUrl": "https://yanxuan-item.nosdn.127.net/b1d2e131c1226e59db7f8b516e604358.png",
		    "soldOut": false,
		    "sortFlag": 0,
		    "commentCount": 0,
		    "onSaleTime": 1568803135928,
		    "picMode": 1,
		    "commentWithPicCount": 0,
		    "underShelf": false,
		    "status": 2,
		    "couponConflict": true,
		    "forbiddenBuy": false,
		    "promotionDesc": "暖冬特惠",
		    "limitedFlag": 204,
		    "pieceNum": 0,
		    "itemSizeTableDetailFlag": false,
		    "forbidExclusiveCal": false,
		    "rewardShareFlag": false,
		    "updateTime": 1576213443639,
		    "showCommentEntrance": true,
		    "pieceUnitDesc": "件",
		    "specialPromTag": "",
		    "counterPrice": 569,
		    "categoryL2Id": 0,
		    "retailPrice": 427,
		    "primarySkuPreSellPrice": 0,
		    "preLimitFlag": 0,
		    "itemPromValid": true,
		    "promTag": "暖冬特惠",
		    "source": 0,
		    "points": 0,
		    "primarySkuPreSellStatus": 0,
		    "extraServiceFlag": 0,
		    "flashPageLink": "",
		    "autoOnsaleTimeLeft": 0,
		    "innerData": {},
		    "saleCenterSkuId": 0,
		    "pointsStatus": 0,
		    "extraPrice": "",
		    "colorNum": 4,
		    "showTime": 0,
		    "autoOnsaleTime": 0,
		    "preemptionStatus": 1,
		    "isPreemption": 0,
		    "zcSearchFlag": false,
		    "name": "男式无缝锁温宽松羽绒服",
		    "appExclusiveFlag": false,
		    "itemType": 1,
		    "listPicUrl": "https://yanxuan-item.nosdn.127.net/c76d77c9c3c7646c060583a618d2bf3b.png",
		    "pointsPrice": 0,
		    "simpleDesc": "时尚酷潮的冬日暖意",
		    "seoTitle": "",
		    "newItemFlag": false,
		    "buttonType": 0,
		    "primarySkuId": 300004325,
		    "displaySkuId": 300004320,
		    "productPlace": "",
		    "itemSizeTableFlag": false
		},
		{
				"isChecked": 1,
				"count": 2,
		    "promId": 0,
		    "showPoints": false,
		    "itemTagList": [
		        {
		            "itemId": 3522116,
		            "tagId": 128111154,
		            "freshmanExclusive": false,
		            "name": "暖冬特惠",
		            "subType": 204,
		            "forbidJump": false,
		            "type": 2
		        }
		    ],
		    "rank": 1,
		    "id": 3522116,
		    "sellVolume": 1931,
		    "primaryPicUrl": "https://yanxuan-item.nosdn.127.net/e8a144cf137fb16d45c610e2431edf17.png",
		    "soldOut": false,
		    "sortFlag": 0,
		    "commentCount": 0,
		    "onSaleTime": 1569865753850,
		    "picMode": 1,
		    "commentWithPicCount": 0,
		    "underShelf": false,
		    "status": 2,
		    "couponConflict": true,
		    "forbiddenBuy": false,
		    "promotionDesc": "暖冬特惠",
		    "limitedFlag": 204,
		    "pieceNum": 0,
		    "itemSizeTableDetailFlag": false,
		    "forbidExclusiveCal": false,
		    "rewardShareFlag": false,
		    "updateTime": 1576200801757,
		    "showCommentEntrance": true,
		    "pieceUnitDesc": "件",
		    "specialPromTag": "",
		    "counterPrice": 1099,
		    "categoryL2Id": 0,
		    "retailPrice": 802,
		    "primarySkuPreSellPrice": 0,
		    "preLimitFlag": 0,
		    "itemPromValid": true,
		    "promTag": "暖冬特惠",
		    "source": 0,
		    "points": 0,
		    "primarySkuPreSellStatus": 0,
		    "extraServiceFlag": 0,
		    "flashPageLink": "",
		    "autoOnsaleTimeLeft": 0,
		    "innerData": {},
		    "saleCenterSkuId": 0,
		    "pointsStatus": 0,
		    "extraPrice": "",
		    "colorNum": 4,
		    "showTime": 0,
		    "autoOnsaleTime": 0,
		    "preemptionStatus": 1,
		    "isPreemption": 0,
		    "zcSearchFlag": false,
		    "name": "强势抗寒之选，男式地表强温工装羽绒服",
		    "appExclusiveFlag": false,
		    "itemType": 1,
		    "listPicUrl": "https://yanxuan-item.nosdn.127.net/1d8a79464c1d5d45400d393d055ac5a2.png",
		    "pointsPrice": 0,
		    "simpleDesc": "舒适的白鹅绒，温暖无所畏惧",
		    "seoTitle": "",
		    "newItemFlag": false,
		    "buttonType": 0,
		    "primarySkuId": 300011034,
		    "displaySkuId": 300011041,
		    "productPlace": "",
		    "itemSizeTableFlag": false
		},
		{
				"isChecked": 0,
				"count": 3,
		    "promId": 0,
		    "showPoints": false,
		    "itemTagList": [
		        {
		            "itemId": 3522117,
		            "tagId": 128111154,
		            "freshmanExclusive": false,
		            "name": "暖冬特惠",
		            "subType": 204,
		            "forbidJump": false,
		            "type": 2
		        }
		    ],
		    "rank": 1,
		    "id": 3522117,
		    "sellVolume": 103,
		    "primaryPicUrl": "https://yanxuan-item.nosdn.127.net/5ad5fa11cd6f10e446c44ac62ff256a2.png",
		    "soldOut": false,
		    "sortFlag": 0,
		    "commentCount": 0,
		    "onSaleTime": 1569864429638,
		    "picMode": 1,
		    "commentWithPicCount": 0,
		    "underShelf": false,
		    "status": 2,
		    "couponConflict": true,
		    "forbiddenBuy": false,
		    "promotionDesc": "暖冬特惠",
		    "limitedFlag": 204,
		    "pieceNum": 0,
		    "itemSizeTableDetailFlag": false,
		    "forbidExclusiveCal": false,
		    "rewardShareFlag": false,
		    "updateTime": 1576223950683,
		    "showCommentEntrance": true,
		    "pieceUnitDesc": "件",
		    "specialPromTag": "",
		    "counterPrice": 899,
		    "categoryL2Id": 0,
		    "retailPrice": 656,
		    "primarySkuPreSellPrice": 0,
		    "preLimitFlag": 0,
		    "itemPromValid": true,
		    "promTag": "暖冬特惠",
		    "source": 0,
		    "points": 0,
		    "primarySkuPreSellStatus": 0,
		    "extraServiceFlag": 0,
		    "flashPageLink": "",
		    "autoOnsaleTimeLeft": 0,
		    "innerData": {},
		    "saleCenterSkuId": 0,
		    "pointsStatus": 0,
		    "extraPrice": "",
		    "colorNum": 2,
		    "showTime": 0,
		    "autoOnsaleTime": 0,
		    "preemptionStatus": 1,
		    "isPreemption": 0,
		    "zcSearchFlag": false,
		    "name": "温度尽在掌控，男式地表强温短款羽绒服",
		    "appExclusiveFlag": false,
		    "itemType": 1,
		    "listPicUrl": "https://yanxuan-item.nosdn.127.net/ea743e5f0137d3a7d5d828ceec850416.png",
		    "pointsPrice": 0,
		    "simpleDesc": "防泼水功能面料，风雨无惧",
		    "seoTitle": "",
		    "newItemFlag": false,
		    "buttonType": 0,
		    "primarySkuId": 300010058,
		    "displaySkuId": 300010059,
		    "productPlace": "",
		    "itemSizeTableFlag": false
		}
	]
}

const mutations = {
	addGoods(state, goods) {
		const isExist = state.goodsDetailInfo.some(item => item.id === goods.id)
		
		if(!isExist) {
			Vue.set(goods, 'count', 1)
			Vue.set(goods, 'isChecked', 1)
			
			state.goodsDetailInfo.push(goods)
		}else {
			state.goodsDetailInfo.find(item => item.id === goods.id).count++
		}
	},
	switchGoodsState(state, {index, isChecked}) {
		state.goodsDetailInfo[index].isChecked = isChecked
	},
	changeGoodsNum(state, {index, type}) {
		if(type) {
			state.goodsDetailInfo[index].count++
		}else {
			if(state.goodsDetailInfo[index].count > 1) {
				state.goodsDetailInfo[index].count--
			}
		}
	},
	changeAllGoodsState(state, isChecked) {
		state.goodsDetailInfo.forEach(item => item.isChecked = isChecked)
	}
}

const actions = {
	
}

const getters = {
	getGoodsNum(state) {
		return state.goodsDetailInfo.reduce((prev, curr) => {
			if(curr.isChecked) {
				return prev += curr.count
			}
			
			return prev
		}, 0)
	},
	getGoodsAllPrice(state) {
		return state.goodsDetailInfo.reduce((prev, curr) => {
			if(curr.isChecked) {
				return prev += curr.count * curr.retailPrice
			}
			
			return prev
		}, 0)
	},
	isAllChecked(state) {
		return state.goodsDetailInfo.every(item => item.isChecked)
	}
}

export default {
	state,
	mutations,
	actions,
	getters
}